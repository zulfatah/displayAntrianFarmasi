import React, { useState, useEffect } from "react";
import axios from "axios";
import "../assets/style.css";

const UpdateStatus = ({ patient, updateStatus, removePatient }) => {
  const [isLoading, setIsLoading] = useState(false);

  const handleStatusChange = async (newStatus) => {
    if (!isLoading) {
      setIsLoading(true);
      try {
        // Save scroll position before reload
        localStorage.setItem("scrollPosition", window.scrollY);

        await axios.post("http://localhost:5000/update-status", {
          id: patient.id,
          status: newStatus,
        },{
          headers: {
              'Authorization': `Bearer ${localStorage.getItem('token')}` // Menambahkan header Authorization
          }
        });
        if (newStatus === "diterima") {
          removePatient(patient.id);
        } else {
          updateStatus(patient.id, newStatus);
          
        }
      } catch (error) {
        console.error("There was an error updating the status!", error);
      } finally {
        setIsLoading(false);
      }
    }
  };

  useEffect(() => {
    // Restore scroll position after reload
    const scrollPosition = localStorage.getItem("scrollPosition");
    if (scrollPosition) {
      window.scrollTo(0, parseInt(scrollPosition, 10));
      localStorage.removeItem("scrollPosition");
    }
  }, []);

  return (
    <div>
      <svg
        onClick={() => handleStatusChange("pending")}
        id="fi_2972543"
        aria-label="Pending Status"
        enableBackground="new 0 0 512 512"
        height="30"
        viewBox="0 0 512 512"
        width="30"
        xmlns="http://www.w3.org/2000/svg"
        className={isLoading ? "nonaktif" : ""}
      >
        <title>Pending</title>
        <g>
          <circle cx="211.748" cy="217.219" fill="#365e7d" r="211.748"></circle>
          <path
            d="m423.496 217.219c0-116.945-94.803-211.748-211.748-211.748-4.761 0-9.482.173-14.165.483 105.408 6.964 189.73 91.05 197.055 196.357.498 7.155-5.367 13.072-12.538 12.919-1.099-.023-2.201-.035-3.306-.035-87.332 0-158.129 70.797-158.129 158.129 0 8.201.627 16.255 1.833 24.118 2.384 15.542-8.906 29.961-24.594 31.022-.107.007-.214.014-.321.021 4.683.309 9.404.483 14.165.483 117.636-.001 211.748-95.585 211.748-211.749z"
            fill="#2b4d66"
          ></path>
          <circle cx="211.748" cy="217.219" fill="#f4fbff" r="162.544"></circle>
          <path
            d="m374.292 217.219c0-89.77-72.773-162.544-162.544-162.544-4.404 0-8.765.181-13.08.525 83.965 6.687 149.953 77.174 149.461 162.972-.003.004-.006.007-.009.011-68.587 13.484-119.741 70.667-126.655 138.902-1.189 11.73-10.375 21.111-22.124 22.097-.224.019-.448.037-.673.055 94.649 7.542 175.624-67.027 175.624-162.018z"
            fill="#daf1f4"
          ></path>
          <g>
            <g>
              <path
                d="m211.748 104.963c-4.268 0-7.726-3.459-7.726-7.726v-10.922c0-4.268 3.459-7.726 7.726-7.726 4.268 0 7.726 3.459 7.726 7.726v10.922c0 4.267-3.458 7.726-7.726 7.726z"
                fill="#365e7d"
              ></path>
            </g>
            <g>
              <path
                d="m296.588 140.105c-1.978 0-3.955-.755-5.464-2.264-3.017-3.017-3.017-7.909.001-10.927l7.723-7.722c3.017-3.017 7.909-3.016 10.927.001 3.017 3.017 3.017 7.909-.001 10.927l-7.723 7.722c-1.508 1.508-3.486 2.263-5.463 2.263z"
                fill="#365e7d"
              ></path>
            </g>
            <g>
              <path
                d="m342.652 224.945h-10.922c-4.268 0-7.726-3.459-7.726-7.726s3.459-7.726 7.726-7.726h10.923c4.268 0 7.726 3.459 7.726 7.726s-3.459 7.726-7.727 7.726z"
                fill="#365e7d"
              ></path>
            </g>
            <g>
              <path
                d="m214.926 359.027c-4.268 0-7.726-3.459-7.726-7.726v-10.923c0-4.268 3.459-7.726 7.726-7.726 4.268 0 7.726 3.459 7.726 7.726v10.923c0 4.268-3.458 7.726-7.726 7.726z"
                fill="#365e7d"
              ></path>
            </g>
            <g>
              <path
                d="m119.185 317.508c-1.977 0-3.955-.755-5.464-2.263-3.017-3.018-3.017-7.909 0-10.928l7.723-7.723c3.018-3.016 7.909-3.016 10.928 0 3.017 3.018 3.017 7.909 0 10.928l-7.723 7.723c-1.51 1.509-3.488 2.263-5.464 2.263z"
                fill="#365e7d"
              ></path>
            </g>
            <g>
              <path
                d="m91.766 224.945h-10.922c-4.268 0-7.726-3.459-7.726-7.726s3.459-7.726 7.726-7.726h10.923c4.268 0 7.726 3.459 7.726 7.726s-3.459 7.726-7.727 7.726z"
                fill="#365e7d"
              ></path>
            </g>
            <g>
              <path
                d="m126.908 140.105c-1.977 0-3.955-.755-5.463-2.263l-7.723-7.722c-3.018-3.017-3.018-7.909-.001-10.927 3.018-3.018 7.91-3.017 10.927-.001l7.723 7.722c3.018 3.017 3.018 7.909.001 10.927-1.509 1.509-3.487 2.264-5.464 2.264z"
                fill="#365e7d"
              ></path>
            </g>
          </g>
          <g>
            <path
              d="m211.75 228.123c-1.976 0-3.921-.758-5.392-2.191l-27.174-26.461c-3.057-2.977-3.122-7.868-.145-10.926 2.976-3.057 7.868-3.123 10.926-.145l14.057 13.688v-54.811c0-4.268 3.459-7.726 7.726-7.726 4.268 0 7.726 3.459 7.726 7.726v73.119c0 3.107-1.86 5.91-4.722 7.119-.97.409-1.99.608-3.002.608z"
              fill="#2b4d66"
            ></path>
          </g>
          <circle cx="378.794" cy="373.323" fill="#eab14d" r="133.206"></circle>
          <path
            d="m378.794 240.117c-5.186 0-10.3.307-15.331.884 66.345 7.604 117.875 63.941 117.875 132.322s-51.53 124.718-117.875 132.322c5.032.577 10.145.884 15.331.884 73.568 0 133.206-59.638 133.206-133.206 0-73.567-59.638-133.206-133.206-133.206z"
            fill="#e49542"
          ></path>
          <g>
            <g>
              <path
                d="m376.353 402c-8.534 0-15.453-6.919-15.453-15.453v-92.257c0-8.534 6.919-15.453 15.453-15.453s15.453 6.919 15.453 15.453v92.258c-.001 8.534-6.919 15.452-15.453 15.452z"
                fill="#f4fbff"
              ></path>
            </g>
            <g>
              <path
                d="m376.353 461.749c-8.534 0-15.453-6.919-15.453-15.453v-9.843c0-8.534 6.919-15.453 15.453-15.453s15.453 6.919 15.453 15.453v9.843c-.001 8.534-6.919 15.453-15.453 15.453z"
                fill="#f4fbff"
              ></path>
            </g>
          </g>
          <g fill="#daf1f4">
            <path d="m376.353 278.837c-2.818 0-5.452.767-7.726 2.084 4.614 2.673 7.726 7.652 7.726 13.369v92.258c0 5.716-3.112 10.696-7.726 13.369 2.275 1.317 4.908 2.084 7.726 2.084 8.534 0 15.453-6.919 15.453-15.453v-92.258c-.001-8.534-6.919-15.453-15.453-15.453z"></path>
            <path d="m376.353 421c-2.818 0-5.452.767-7.726 2.084 4.614 2.673 7.726 7.652 7.726 13.369v9.843c0 5.716-3.112 10.696-7.726 13.369 2.275 1.317 4.908 2.084 7.726 2.084 8.534 0 15.453-6.919 15.453-15.453v-9.843c-.001-8.534-6.919-15.453-15.453-15.453z"></path>
          </g>
        </g>
      </svg>
      <svg
        onClick={async () => handleStatusChange("selesai")}
        clipRule="evenodd"
        fillRule="evenodd"
        height="30"
        imageRendering="optimizeQuality"
        shapeRendering="geometricPrecision"
        textRendering="geometricPrecision"
        viewBox="0 0 512 512"
        width="30"
        xmlns="http://www.w3.org/2000/svg"
        id="fi_10571375"
        className={isLoading ? "nonaktif" : ""}
      >
        <title>Selesai</title>
        <g id="Layer_x0020_1">
          <g id="_1527230751888">
            <path
              d="m295.07 44.29h-78.14c-2.76 0-5-2.24-5-5v-22.41c0-9.29 7.56-16.84 16.85-16.84l54.44-.01c9.29 0 16.85 7.56 16.85 16.85v22.41c0 2.76-2.24 5-5 5z"
              fill="#8d878f"
            ></path>
            <path
              d="m330.28 91.63h-148.56c-2.76 0-4.99-2.24-4.99-5v-30.96c0-11.79 9.58-21.38 21.37-21.38h115.8c11.79 0 21.37 9.59 21.37 21.38v30.96c0 2.76-2.23 5-4.99 5z"
              fill="#726b74"
            ></path>
            <path
              d="m415.59 511.96h-319.18c-18.08 0-32.79-14.7-32.79-32.77v-364.78c0-18.07 14.71-32.78 32.79-32.78h319.18c18.08 0 32.79 14.71 32.79 32.78v364.78c0 18.07-14.71 32.77-32.79 32.77z"
              fill="#d8aa8b"
            ></path>
            <path
              d="m402.86 471.45h-293.72c-2.77 0-5-2.24-5-5v-339.31c0-2.76 2.23-4.99 5-4.99h293.72c2.77 0 5 2.23 5 4.99v339.31c0 2.76-2.23 5-5 5z"
              fill="#f8f5f8"
            ></path>
            <path
              d="m212.73 241.94h-76.67c-2.76 0-4.99-2.24-4.99-5v-69.15c0-2.76 2.23-5 4.99-5h76.67c2.76 0 5 2.24 5 5v69.15c0 2.76-2.24 5-5 5z"
              fill="#3ca86a"
            ></path>
            <path
              d="m163.51 222.55c-.22 0-.43-.02-.65-.05-1.54-.2-2.9-1.11-3.68-2.46l-8.58-14.86c-1.38-2.39-.56-5.45 1.83-6.83s5.45-.56 6.83 1.83l5.32 9.22 25.75-25.75c1.95-1.95 5.12-1.95 7.07 0 1.96 1.95 1.96 5.12 0 7.07l-30.35 30.36c-.95.95-2.22 1.47-3.54 1.47z"
              fill="#fff"
            ></path>
            <g fill="#726b74">
              <path d="m375.94 183.81h-131.55c-2.76 0-5-2.24-5-5s2.24-5 5-5h131.55c2.76 0 5 2.24 5 5s-2.24 5-5 5z"></path>
              <path d="m375.94 207.36h-131.55c-2.76 0-5-2.23-5-4.99 0-2.77 2.24-5 5-5h131.55c2.76 0 5 2.23 5 5 0 2.76-2.24 4.99-5 4.99z"></path>
              <path d="m375.94 230.92h-131.55c-2.76 0-5-2.24-5-5s2.24-5 5-5h131.55c2.76 0 5 2.24 5 5s-2.24 5-5 5z"></path>
            </g>
            <path
              d="m212.73 336.37h-76.67c-2.76 0-4.99-2.23-4.99-5v-69.14c0-2.77 2.23-5 4.99-5h76.67c2.76 0 5 2.23 5 5v69.14c0 2.76-2.24 5-5 5z"
              fill="#3ca86a"
            ></path>
            <path
              d="m163.51 316.98c-.22 0-.43-.02-.65-.05-1.54-.2-2.9-1.1-3.68-2.45l-8.58-14.87c-1.38-2.39-.57-5.44 1.83-6.83 2.39-1.38 5.45-.56 6.83 1.83l5.32 9.23 25.75-25.75c1.95-1.96 5.12-1.96 7.07-.01 1.95 1.96 1.95 5.12 0 7.07l-30.36 30.36c-.94.95-2.21 1.47-3.53 1.47z"
              fill="#fff"
            ></path>
            <path
              d="m375.94 278.25h-131.55c-2.76 0-5-2.24-5-5s2.24-5 5-5h131.55c2.76 0 5 2.24 5 5s-2.24 5-5 5z"
              fill="#726b74"
            ></path>
            <path
              d="m375.94 301.8h-131.55c-2.76 0-5-2.24-5-5s2.24-5 5-5h131.55c2.76 0 5 2.24 5 5s-2.24 5-5 5z"
              fill="#726b74"
            ></path>
            <path
              d="m375.94 325.35h-131.55c-2.76 0-5-2.24-5-5s2.24-5 5-5h131.55c2.76 0 5 2.24 5 5s-2.24 5-5 5z"
              fill="#726b74"
            ></path>
            <path
              d="m212.73 430.81h-76.67c-2.76 0-4.99-2.24-4.99-5v-69.15c0-2.76 2.23-5 4.99-5h76.67c2.76 0 5 2.24 5 5v69.15c0 2.76-2.24 5-5 5z"
              fill="#3ca86a"
            ></path>
            <path
              d="m163.51 411.41c-.22 0-.43-.01-.65-.04-1.54-.2-2.9-1.11-3.68-2.46l-8.58-14.86c-1.38-2.39-.57-5.45 1.83-6.83 2.39-1.38 5.44-.56 6.83 1.83l5.32 9.22 25.75-25.75c1.95-1.95 5.12-1.95 7.07 0 1.96 1.95 1.96 5.12 0 7.07l-30.35 30.36c-.95.94-2.22 1.46-3.54 1.46z"
              fill="#fff"
            ></path>
            <path
              d="m375.94 372.68h-131.55c-2.76 0-5-2.24-5-5s2.24-5 5-5h131.55c2.76 0 5 2.24 5 5s-2.24 5-5 5z"
              fill="#726b74"
            ></path>
            <path
              d="m375.94 396.23h-131.55c-2.76 0-5-2.24-5-5s2.24-5 5-5h131.55c2.76 0 5 2.24 5 5s-2.24 5-5 5z"
              fill="#726b74"
            ></path>
            <path
              d="m375.94 419.79h-131.55c-2.76 0-5-2.24-5-5s2.24-5 5-5h131.55c2.76 0 5 2.24 5 5s-2.24 5-5 5z"
              fill="#726b74"
            ></path>
          </g>
        </g>
      </svg>
      <div className={patient.status === "selesai" ? "inline" : "kotak"}>
      <svg
        onClick={() => handleStatusChange("diterima")}
        id="fi_10720847"
        height="30"
        viewBox="0 0 512 512"
        width="30"
        xmlns="http://www.w3.org/2000/svg"
        data-name="Flat"
        className={patient.status === "selesai" ? "" : "nonaktif"}
      >
        <title>Diterima</title>
        <path d="m72 8-64 64v432h384v-496z" fill="#c8e1ff"></path>
        <path d="m8 72h64v-64z" fill="#aaccfa"></path>
        <g fill="#5f6473">
          <path d="m345.544 291.274h-287.321c-4.418 0-8-3.582-8-8s3.582-8 8-8h287.321c4.418 0 8 3.582 8 8s-3.582 8-8 8z"></path>
          <path d="m217.3 344.057h-159.077c-4.418 0-8-3.582-8-8s3.582-8 8-8h159.077c4.418 0 8 3.582 8 8s-3.582 8-8 8z"></path>
          <path d="m190.181 396.839h-131.958c-4.418 0-8-3.582-8-8s3.582-8 8-8h131.958c4.418 0 8 3.582 8 8s-3.582 8-8 8z"></path>
          <path d="m207.13 451.425h-148.907c-4.418 0-8-3.582-8-8s3.582-8 8-8h148.907c4.418 0 8 3.582 8 8s-3.582 8-8 8z"></path>
        </g>
        <circle cx="201.883" cy="151.32" fill="#ffe180" r="79.173"></circle>
        <path
          d="m193.445 194.586c-1.6 0-3.21-.478-4.605-1.462l-25.119-17.707c-3.611-2.545-4.475-7.537-1.93-11.148 2.546-3.611 7.536-4.476 11.148-1.929l19.188 13.526 40.559-47.042c2.885-3.344 7.937-3.719 11.282-.835 3.347 2.885 3.721 7.937.835 11.283l-45.296 52.537c-1.573 1.825-3.807 2.776-6.062 2.776z"
          fill="#5f6473"
        ></path>
        <path
          d="m375.026 369.54c-47.533-27.443-92.813-38.002-101.137-23.584l-30.144 52.212 171.917 99.75 30.358-52.582c8.324-14.418-23.461-48.353-70.993-75.796z"
          fill="#ffd36c"
        ></path>
        <path
          d="m478.525 190.827c-24.368-14.069-55.527-5.72-69.595 18.648-4.029 6.978-6.219 14.514-6.722 22.045 0 0-1.547 38.757-20.772 72.057-17.786 30.806-50.409 44.996-50.409 44.996l-1.746 2.532c13.855 5.093 29.057 12.262 44.246 21.031 15.313 8.841 29.282 18.531 40.815 28.224l1.321-2.923s-4.022-35.349 13.763-66.154c19.226-33.3 52.027-54.025 52.027-54.025 6.267-4.2 11.694-9.862 15.721-16.837 14.069-24.368 5.72-55.527-18.648-69.596z"
          fill="#e64b73"
        ></path>
        <path
          d="m375.026 369.54c-47.533-27.443-92.813-38.002-101.137-23.584l-30.144 52.212 2.595 1.506.003-.006c2.363-4.093 9.042-4.951 14.228-4.951 19.421 0 51.152 11.354 82.812 29.633 22.74 13.13 42.541 28.129 55.753 42.235 12.068 12.885 17.354 23.898 14.143 29.463-.071.123-.158.233-.236.35l2.62 1.52 30.358-52.582c8.324-14.418-23.461-48.353-70.993-75.796z"
          fill="#fa5f87"
        ></path>
        <ellipse
          cx="329.81"
          cy="447.858"
          fill="#5f6473"
          rx="30.145"
          ry="99.38"
          transform="matrix(.5 -.866 .866 .5 -222.952 509.551)"
        ></ellipse>
      </svg>
      </div>
    </div>
  );
};

export default UpdateStatus;
